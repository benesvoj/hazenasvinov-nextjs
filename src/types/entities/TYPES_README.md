# Entity Types Organization

## Overview

Entity types are organized into two categories:
- **Schema types** (auto-generated from database)
- **Data types** (manually maintained for application needs)

## Directory Structure

```
types/entities/{entity}/
├── schema/
│   └── {entity}Schema.ts     # ⚠️ AUTO-GENERATED - DO NOT EDIT
├── data/
│   └── {entity}.ts           # Application types (manually maintained)
└── index.ts                  # Re-exports
```

## Schema Types (Auto-Generated)

**Location**: `schema/{entity}Schema.ts`

**Generated by**: `npm run generate:types`

**Never edit manually** - changes will be overwritten!

### Example:
```typescript
// src/types/entities/video/schema/videosSchema.ts

/**
 * Database schema for `videos` table
 *
 * ⚠️ AUTO-GENERATED - DO NOT EDIT MANUALLY
 * Generated by: scripts/split-db-types.js
 * Source: src/types/database/supabase.ts
 *
 * Last generated: 2025-11-20
 */

// Base schema - matches database exactly
export interface VideoSchema {
  id: string;
  title: string;
  description: string | null;
  youtube_url: string;
  youtube_id: string;
  category_id: string;
  club_id: string | null;
  season_id: string | null;
  recording_date: string | null;
  duration: string | null;
  thumbnail_url: string | null;
  is_active: boolean | null;
  created_at: string | null;
  updated_at: string | null;
  created_by: string | null;
  updated_by: string | null;
}

// Insert type - for creating new records
export type VideoInsert = Omit<
  VideoSchema,
  'id' | 'created_at' | 'updated_at'
> & {
  id?: string; // Optional for inserts
};

// Update type - for updating records
export type VideoUpdate = {
  id: string;
} & Partial<Omit<VideoSchema, 'id' | 'created_at' | 'updated_at'>>;
```

### When to Regenerate

Run `npm run generate:types` after:
- Creating new database tables
- Adding/removing columns
- Changing column types
- Renaming columns

## Data Types (Manually Maintained)

**Location**: `data/{entity}.ts`

**Purpose**: Application-specific types that extend schemas

### Type Categories:

#### 1. Entity with Relations
```typescript
// src/types/entities/video/data/video.ts

/**
 * Video with joined relations
 * Used when fetching videos with category/club/season data
 */
export interface Video extends VideoSchema {
  category?: {
    id: string;
    name: string;
    code: string;
  };
  clubs?: {
    id: string;
    name: string;
    short_name: string;
  };
  seasons?: {
    id: string;
    name: string;
    start_date: string;
    end_date: string;
  };
  match_ids?: string[];
}
```

#### 2. Context-Specific Types
```typescript
/**
 * Video with associated match information
 * Used in match preparation and strategy contexts
 */
export interface VideoWithMatch extends VideoSchema {
  match?: {
    id: string;
    date: string;
    status: 'upcoming' | 'completed';
    home_team: {
      id: string;
      name: string;
      short_name: string;
    };
    away_team: {
      id: string;
      name: string;
      short_name: string;
    };
    home_score?: number | null;
    away_score?: number | null;
    home_score_halftime?: number | null;
    away_score_halftime?: number | null;
  };
}
```

#### 3. Form Data Types
```typescript
/**
 * Form data for creating/editing videos
 * Contains only user-editable fields
 */
export interface VideoFormData {
  title: string;
  description: string | null;
  youtube_url: string;
  category_id: string;
  club_id: string | null;
  recording_date: string | null;
  season_id: string | null;
  is_active: boolean;
}
```

#### 4. Filter Types
```typescript
/**
 * Filter criteria for videos
 */
export interface VideoFilters {
  category_id?: string;
  club_id?: string;
  season_id?: string;
  is_active?: boolean;
  search?: string;
}
```

## Naming Conventions

### Schema Types (Auto-Generated)
| Type | Pattern | Example |
|------|---------|---------|
| Base Schema | `{Entity}Schema` | `VideoSchema` |
| Insert Type | `{Entity}Insert` | `VideoInsert` |
| Update Type | `{Entity}Update` | `VideoUpdate` |

### Data Types (Manual)
| Type | Pattern | Example | Purpose |
|------|---------|---------|---------|
| With Relations | `{Entity}` | `Video` | Standard relations |
| Context-Specific | `{Entity}With{Context}` | `VideoWithMatch` | Specific context |
| Form Data | `{Entity}FormData` | `VideoFormData` | Form input |
| Filters | `{Entity}Filters` | `VideoFilters` | Filter criteria |
| Metadata | `{Entity}Metadata` | `VideoMetadata` | Additional data |

## When to Create New Types

### Create New Schema Type:
❌ Never - these are auto-generated

### Create New Data Type When:
✅ Adding relations to an entity
✅ Creating context-specific views
✅ Defining form input structure
✅ Defining filter criteria

### Examples:

```typescript
// ✅ Good - specific context
export interface VideoWithMatch extends VideoSchema {
  match?: MatchData;
}

// ✅ Good - form subset
export interface VideoFormData {
  title: string;
  youtube_url: string;
  // ... only editable fields
}

// ❌ Bad - duplicating schema
export interface Video {
  id: string;
  title: string;
  // ... duplicating VideoSchema
}
```

## Type Exports

### Entity Index
```typescript
// src/types/entities/video/index.ts
export * from './schema/videosSchema';  // Schema types
export * from './data/video';           // Data types
```

### Main Types Index
```typescript
// src/types/index.ts
export * from './entities/video';
export * from './entities/match';
// ... all entities
```

## Importing Types

### ✅ Correct Import Patterns
```typescript
// Import from main index
import {VideoSchema, Video, VideoWithMatch, VideoFormData} from '@/types';

// Import specific entity
import {VideoSchema} from '@/types/entities/video';
```

### ❌ Incorrect Import Patterns
```typescript
// ❌ Don't import from deep paths
import {VideoSchema} from '@/types/entities/video/schema/videosSchema';

// ❌ Don't import from database types
import {VideoSchema} from '@/types/database/supabase';
```

## Type Usage Guidelines

### Use VideoSchema When:
- ✅ Working directly with database (query layer)
- ✅ API responses without relations
- ✅ Type parameter for factory hooks

### Use Video When:
- ✅ Displaying data with relations
- ✅ Components that show category/club/season
- ✅ General application usage

### Use VideoWithMatch When:
- ✅ Match preparation contexts
- ✅ Strategy analysis
- ✅ Components that display match info

### Use VideoFormData When:
- ✅ Form state management
- ✅ User input handling
- ✅ Validation logic

### Use VideoInsert When:
- ✅ Creating new records
- ✅ API POST requests
- ✅ Database insertions

## Common Patterns

### Pattern 1: Extending Schema with Relations
```typescript
export interface Video extends VideoSchema {
  // Add optional relations
  category?: Category;
  clubs?: Club;
  seasons?: Season;
}
```

### Pattern 2: Partial Relations
```typescript
export interface Video extends VideoSchema {
  // Only include needed fields from relation
  category?: Pick<Category, 'id' | 'name' | 'code'>;
}
```

### Pattern 3: Required Relations
```typescript
export interface VideoWithCategory extends VideoSchema {
  // Require specific relation
  category: Category;
}
```

### Pattern 4: Form Subsets
```typescript
// Only user-editable fields
export interface VideoFormData extends Pick<VideoSchema,
  'title' | 'description' | 'youtube_url' | 'category_id' | 'is_active'
> {
  // Override nullable fields for forms
  description: string; // Not null in form
}
```

## AI Guidelines

When working with types:

1. **Check if type exists** before creating new ones
2. **Never edit schema files** - they're auto-generated
3. **Extend schema types** for relations
4. **Create context-specific types** for clarity
5. **Follow naming conventions**
6. **Export from index files**
7. **Use specific types** over generic ones

## Troubleshooting

### Issue: Type not found
**Solution**: Check exports in index.ts files

### Issue: Type mismatch
**Solution**: Verify you're using the right type for the context

### Issue: Property doesn't exist
**Solution**: Use extended type (e.g., VideoWithMatch instead of VideoSchema)

### Issue: Schema changes not reflected
**Solution**: Run `npm run generate:types`

## Related Documentation

- [Layered Architecture](../../docs/architecture/LAYERED_ARCHITECTURE.md)
- [Type Organization](../../docs/architecture/TYPE_ORGANIZATION.md)
- [Development Guidelines](../../docs/DEVELOPMENT_GUIDELINES.md)
